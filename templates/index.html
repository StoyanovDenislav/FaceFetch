<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Facial Recognition System</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      color: white;
      margin-bottom: 30px;
    }

    h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }

    .subtitle {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .main-content {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    @media (max-width: 1024px) {
      .main-content {
        grid-template-columns: 1fr;
      }
    }

    .video-container {
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .video-wrapper {
      position: relative;
      width: 100%;
      background: #000;
      border-radius: 10px;
      overflow: hidden;
    }

    #videoFeed {
      width: 100%;
      height: auto;
      display: block;
    }

    .stats-container {
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .stats-container h2 {
      color: #667eea;
      margin-bottom: 20px;
      border-bottom: 3px solid #667eea;
      padding-bottom: 10px;
    }

    .stat-item {
      background: #f8f9fa;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }

    .stat-label {
      font-weight: bold;
      color: #555;
      margin-bottom: 5px;
    }

    .stat-value {
      font-size: 1.2em;
      color: #333;
    }

    .detection-panel {
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .detection-panel h2 {
      color: #667eea;
      margin-bottom: 20px;
      border-bottom: 3px solid #667eea;
      padding-bottom: 10px;
    }

    .face-card {
      background: #f8f9fa;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 8px;
      border-left: 4px solid #28a745;
    }

    .face-card.unknown {
      border-left-color: #ffc107;
    }

    .face-card.spoof {
      border-left-color: #dc3545;
    }

    .face-card.pending {
      border-left-color: #17a2b8;
    }

    .face-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .face-name {
      font-weight: bold;
      font-size: 1.1em;
      color: #333;
    }

    .face-badge {
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.8em;
      font-weight: bold;
      text-transform: uppercase;
    }

    .badge-known {
      background: #28a745;
      color: white;
    }

    .badge-unknown {
      background: #ffc107;
      color: #333;
    }

    .badge-spoof {
      background: #dc3545;
      color: white;
    }

    .badge-pending {
      background: #17a2b8;
      color: white;
    }

    .face-details {
      font-size: 0.9em;
      color: #666;
      line-height: 1.6;
    }

    .live-indicator {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 5px;
    }

    .live-indicator.live {
      background: #28a745;
      box-shadow: 0 0 5px #28a745;
    }

    .live-indicator.not-live {
      background: #dc3545;
    }

    .no-faces {
      text-align: center;
      color: #999;
      padding: 40px;
      font-size: 1.1em;
    }

    .history-item {
      background: #f8f9fa;
      padding: 12px;
      margin-bottom: 10px;
      border-radius: 8px;
      border-left: 4px solid #667eea;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.9em;
    }

    .history-item.spoof {
      border-left-color: #dc3545;
    }

    .history-item.known {
      border-left-color: #28a745;
    }

    .history-item.unknown {
      border-left-color: #ffc107;
    }

    .history-time {
      font-size: 0.85em;
      color: #666;
      margin-bottom: 3px;
    }

    .history-name {
      font-weight: bold;
      color: #333;
    }

    .api-info {
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      margin-top: 20px;
    }

    .api-info h2 {
      color: #667eea;
      margin-bottom: 15px;
    }

    .api-endpoint {
      background: #f8f9fa;
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
      font-family: "Courier New", monospace;
      font-size: 0.9em;
    }

    .refresh-status {
      text-align: center;
      color: white;
      margin-top: 10px;
      font-size: 0.9em;
    }

    .alert-panel {
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      margin-bottom: 20px;
    }

    .alert-panel h2 {
      color: #dc3545;
      margin-bottom: 20px;
      border-bottom: 3px solid #dc3545;
      padding-bottom: 10px;
    }

    .alert-item {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 8px;
      position: relative;
    }

    .alert-item.spoof {
      background: #f8d7da;
      border-left-color: #dc3545;
    }

    .alert-item.unknown {
      background: #fff3cd;
      border-left-color: #ffc107;
    }

    .alert-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .alert-type {
      font-weight: bold;
      text-transform: uppercase;
      font-size: 0.9em;
    }

    .alert-time {
      font-size: 0.85em;
      color: #666;
    }

    .alert-message {
      color: #333;
      margin-bottom: 8px;
    }

    .alert-dismiss {
      background: #6c757d;
      color: white;
      border: none;
      padding: 5px 12px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.85em;
    }

    .alert-dismiss:hover {
      background: #5a6268;
    }

    .alarm-banner {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: #dc3545;
      color: white;
      padding: 15px;
      text-align: center;
      font-size: 1.2em;
      font-weight: bold;
      z-index: 1000;
      display: none;
      animation: pulse 1s infinite;
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.7;
      }
    }

    .alarm-dismiss {
      background: white;
      color: #dc3545;
      border: none;
      padding: 8px 20px;
      margin-left: 20px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }

    .alarm-dismiss:hover {
      background: #f8f9fa;
    }

    .audio-notice {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #ffc107;
      color: #333;
      padding: 15px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      font-weight: bold;
      z-index: 999;
      display: none;
    }
  </style>
</head>

<body>
  <!-- Alarm Banner -->
  <div id="alarmBanner" class="alarm-banner">
    üö® SECURITY ALERT: Unauthorized Access Detected! üö®
    <button class="alarm-dismiss" onclick="dismissAlarm()">Dismiss</button>
  </div>

  <!-- Audio Notice -->
  <div id="audioNotice" class="audio-notice">
    üîä Click anywhere to enable alarm sounds
  </div>

  <!-- Alarm Sound (hidden audio element) -->
  <audio id="alarmSound" loop>
    <source
      src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjGN1fPKdSYFKHzM8NiTRQoSZLjr65lOEAtPpeL0s2QdBjiP1fLNfC0GJHnJ8NySQgoTXrTp7KlXFApGnt/yvmsiBy+K0/LJfC0GJHnJ8NySQgoTXrTp7KlXFApGnt/yvmsiBy+K0/LJfC0GJHnJ8NySQgoTXrTp7KlXFApGnt/yvmsiBy+K0/LJfC0GJHnJ8NySQgoTXrTp7KlXFApGnt/yvmsiBy+K0/LJfC0GJHnJ8NySQgoTXrTp7KlXFApGnt/yvmsiBy+K0/LJfC0GJHnJ8NySQgoTXrTp7KlXFApGnt/yvmsiBy+K0/LJfC0GJHnJ8NySQgoTXrTp7KlXFApGnt/yvmsiBy+K0/LJfC0GJHnJ8NySQgoTXrTp7KlXFApGnt/yvmsiBy+K0/LJfC0GJHnJ8NySQgoTXrTp7KlXFApGnt/yvmsiBy+K0/LJfC0GJHnJ8NySQgoTXrTp7KlXFApGnt/yvmsiBy+K0/LJfC0GJHnJ8NySQgoTXrTp7KlXFApGnt/yvmsiBy+K0/LJfC0GJHnJ8NySQg=="
      type="audio/wav" />
  </audio>
  <!-- Nuclear EAS Alarm Generator -->
  <script>
    // Create dramatic EAS-style alarm using Web Audio API
    let audioContext;
    let oscillator1, oscillator2, oscillator3;
    let gainNode;
    let isAlarmPlaying = false;

    function createEASAlarm() {
      if (!audioContext) {
        audioContext = new (window.AudioContext ||
          window.webkitAudioContext)();
      }

      // Stop any existing alarm
      stopEASAlarm();

      // Create three oscillators for that classic EAS sound
      oscillator1 = audioContext.createOscillator();
      oscillator2 = audioContext.createOscillator();
      oscillator3 = audioContext.createOscillator();

      // Create gain node for volume control
      gainNode = audioContext.createGain();

      // Classic EAS frequencies (853Hz and 960Hz alternating)
      oscillator1.frequency.value = 853;
      oscillator2.frequency.value = 960;
      oscillator3.frequency.value = 1050;

      // Square wave for that harsh EAS sound
      oscillator1.type = "square";
      oscillator2.type = "square";
      oscillator3.type = "square";

      // Set volume
      gainNode.gain.value = 0.3;

      // Connect oscillators to gain, then to output
      oscillator1.connect(gainNode);
      oscillator2.connect(gainNode);
      oscillator3.connect(gainNode);
      gainNode.connect(audioContext.destination);

      // Start oscillators
      oscillator1.start();
      oscillator2.start();
      oscillator3.start();

      // Create pulsing effect
      let startTime = audioContext.currentTime;
      for (let i = 0; i < 100; i++) {
        gainNode.gain.setValueAtTime(0.3, startTime + i * 0.5);
        gainNode.gain.setValueAtTime(0.0, startTime + i * 0.5 + 0.25);
      }

      isAlarmPlaying = true;
    }

    function stopEASAlarm() {
      if (oscillator1) {
        try {
          oscillator1.stop();
        } catch (e) { }
        oscillator1 = null;
      }
      if (oscillator2) {
        try {
          oscillator2.stop();
        } catch (e) { }
        oscillator2 = null;
      }
      if (oscillator3) {
        try {
          oscillator3.stop();
        } catch (e) { }
        oscillator3 = null;
      }
      isAlarmPlaying = false;
    }
  </script>
  <div class="container">
    <header>
      <h1>üîí Facial Recognition System</h1>
      <p class="subtitle">Real-time Face Detection & Anti-Spoofing</p>
      <div style="margin-top: 15px;">
        <a href="/register"
          style="color: white; text-decoration: none; background: rgba(255,255,255,0.2); padding: 10px 20px; border-radius: 5px; display: inline-block;">
          üë§ Register New User
        </a>
      </div>
    </header>

    <div class="main-content">
      <div class="video-container">
        <h2 style="color: #667eea; margin-bottom: 15px">
          üìπ Live Camera Feed
        </h2>
        <div class="video-wrapper">
          <img id="videoFeed" src="{{ url_for('video_feed') }}" alt="Video Feed" />
        </div>
      </div>

      <div class="stats-container">
        <h2>üìä System Status</h2>
        <div class="stat-item">
          <div class="stat-label">Camera Type</div>
          <div class="stat-value" id="cameraType">Loading...</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Known Faces</div>
          <div class="stat-value" id="knownFaces">Loading...</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Active Detections</div>
          <div class="stat-value" id="totalFaces">0</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Last Update</div>
          <div class="stat-value" id="lastUpdate">Never</div>
        </div>
      </div>
    </div>

    <div class="detection-panel">
      <h2>üë• Detected Faces</h2>
      <div id="facesContainer">
        <div class="no-faces">No faces detected</div>
      </div>
    </div>

    <div class="detection-panel">
      <h2>
        üìú Detection History
        <button id="clearHistory" style="
              float: right;
              padding: 5px 15px;
              background: #dc3545;
              color: white;
              border: none;
              border-radius: 5px;
              cursor: pointer;
            ">
          Clear History
        </button>
      </h2>
      <div id="historyContainer">
        <div class="no-faces">No history yet</div>
      </div>
    </div>

    <!-- Security Alerts Panel -->
    <div class="alert-panel">
      <h2>
        üö® Security Alerts
        <button id="clearAlerts" style="
              float: right;
              padding: 5px 15px;
              background: #dc3545;
              color: white;
              border: none;
              border-radius: 5px;
              cursor: pointer;
            ">
          Clear All
        </button>
      </h2>
      <div id="alertsContainer">
        <div class="no-faces">No alerts</div>
      </div>
    </div>

    <div class="api-info">
      <h2>üîå API Endpoints</h2>
      <p>Access detection data programmatically:</p>
      <div class="api-endpoint">
        GET /api/detections - Get current detection results (JSON)
      </div>
      <div class="api-endpoint">
        GET /api/status - Get system status (JSON)
      </div>
    </div>

    <div class="detection-panel">
      <h2>üìÑ Raw JSON Data</h2>
      <pre id="jsonData" style="
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            max-height: 400px;
            overflow-y: auto;
          ">
Loading...</pre>
    </div>

    <div class="refresh-status">
      Auto-refreshing every second ‚Ä¢
      <span id="connectionStatus">Connected</span>
    </div>
  </div>

  <script>
    let lastTimestamp = 0;
    let alarmSound = document.getElementById("alarmSound");
    let alarmBanner = document.getElementById("alarmBanner");
    let alarmActive = false;
    let lastAlertCount = 0;
    let audioEnabled = false;
    let unknownDetectionStart = null; // Track when unknown first detected
    let lastAlarmTime = 0; // Track last time alarm was triggered
    const ALARM_COOLDOWN = 30000; // 30 seconds between alarms
    const DETECTION_DELAY = 2500; // 2.5 seconds before triggering alarm

    // Enable audio on first user interaction
    document.addEventListener(
      "click",
      function enableAudio() {
        audioEnabled = true;
        document.getElementById("audioNotice").style.display = "none";
        document.removeEventListener("click", enableAudio);
        console.log("Audio enabled");
      },
      { once: true }
    );

    // Show audio notice initially
    setTimeout(() => {
      if (!audioEnabled) {
        document.getElementById("audioNotice").style.display = "block";
      }
    }, 2000);

    function triggerAlarm() {
      const currentTime = Date.now();

      // Check cooldown period
      if (currentTime - lastAlarmTime < ALARM_COOLDOWN) {
        console.log("Alarm in cooldown period");
        return;
      }

      console.log("Triggering alarm!");
      if (!alarmActive) {
        alarmActive = true;
        lastAlarmTime = currentTime;
        alarmBanner.style.display = "block";

        if (audioEnabled) {
          // Use Web Audio API for EAS alarm
          createEASAlarm();
        } else {
          console.log("Audio not enabled yet - click anywhere to enable");
        }

        // Auto-dismiss after 15 seconds
        setTimeout(() => {
          stopAlarm();
        }, 15000);
      }
    }

    function dismissAlarm() {
      stopAlarm();
    }

    function stopAlarm() {
      console.log("Stopping alarm");
      alarmActive = false;
      alarmBanner.style.display = "none";
      stopEASAlarm(); // Stop the EAS alarm
      alarmSound.pause();
      alarmSound.currentTime = 0;
    }

    async function updateAlerts() {
      try {
        const response = await fetch("/api/alerts?unacknowledged=true");
        const data = await response.json();

        console.log("Alerts data:", data);

        const container = document.getElementById("alertsContainer");
        const currentTime = Date.now();

        if (data.total_alerts === 0) {
          container.innerHTML = '<div class="no-faces">No alerts</div>';
          unknownDetectionStart = null; // Reset detection timer
          if (alarmActive && lastAlertCount > 0) {
            stopAlarm();
          }
        } else {
          // Check if we have new alerts
          if (data.total_alerts > lastAlertCount) {
            // Start detection timer if not already started
            if (unknownDetectionStart === null) {
              unknownDetectionStart = currentTime;
              console.log("Unknown/spoof detected, starting timer...");
            }

            // Check if sustained for required duration
            const detectionDuration = currentTime - unknownDetectionStart;
            if (detectionDuration >= DETECTION_DELAY) {
              console.log(
                "Sustained detection for",
                detectionDuration,
                "ms - triggering alarm"
              );
              triggerAlarm();
              unknownDetectionStart = null; // Reset after triggering
            } else {
              console.log(
                "Detection duration:",
                detectionDuration,
                "ms (need",
                DETECTION_DELAY,
                "ms)"
              );
            }
          }
          lastAlertCount = data.total_alerts;

          container.innerHTML = "";

          data.alerts.forEach((alert, index) => {
            const alertItem = document.createElement("div");
            alertItem.className = `alert-item ${alert.type}`;

            const date = new Date(alert.timestamp * 1000);
            const timeString = date.toLocaleTimeString();

            alertItem.innerHTML = `
                <div class="alert-header">
                  <span class="alert-type">${alert.type === "spoof"
                ? "üö´ SPOOF DETECTED"
                : "‚ö†Ô∏è UNKNOWN PERSON"
              }</span>
                  <span class="alert-time">${timeString}</span>
                </div>
                <div class="alert-message">${alert.message}</div>
                <button class="alert-dismiss" onclick="acknowledgeAlert(${index})">Dismiss</button>
              `;

            container.appendChild(alertItem);
          });
        }
      } catch (error) {
        console.error("Error fetching alerts:", error);
      }
    }

    async function acknowledgeAlert(index) {
      try {
        await fetch(`/api/alerts/${index}/acknowledge`, { method: "POST" });
        updateAlerts();
      } catch (error) {
        console.error("Error acknowledging alert:", error);
      }
    }

    async function clearAllAlerts() {
      try {
        await fetch("/api/alerts/clear", { method: "POST" });
        stopAlarm();
        lastAlertCount = 0;
        updateAlerts();
      } catch (error) {
        console.error("Error clearing alerts:", error);
      }
    }

    // Clear alerts button
    document
      .getElementById("clearAlerts")
      .addEventListener("click", clearAllAlerts);

    async function updateDetections() {
      try {
        const response = await fetch("/api/detections");
        const data = await response.json();

        // Update total faces
        document.getElementById("totalFaces").textContent = data.total_faces;

        // Update last update time
        const now = new Date(data.timestamp * 1000);
        document.getElementById("lastUpdate").textContent =
          now.toLocaleTimeString();

        // Update faces display
        const container = document.getElementById("facesContainer");

        if (data.total_faces === 0) {
          container.innerHTML =
            '<div class="no-faces">No faces detected</div>';
        } else {
          container.innerHTML = "";

          data.faces.forEach((face, index) => {
            const faceCard = document.createElement("div");
            faceCard.className = `face-card ${face.state}`;

            const badgeClass =
              face.state === "known"
                ? "badge-known"
                : face.state === "unknown"
                  ? "badge-unknown"
                  : face.state === "spoof"
                    ? "badge-spoof"
                    : "badge-pending";

            const liveClass = face.is_live ? "live" : "not-live";
            const liveText = face.is_live ? "Live" : "Not Live";

            faceCard.innerHTML = `
                            <div class="face-header">
                                <div class="face-name">Face #${index + 1}</div>
                                <span class="face-badge ${badgeClass}">${face.state
              }</span>
                            </div>
                            <div class="face-details">
                                <strong>Name:</strong> ${face.name || "Unknown"
              }<br>
                                ${face.confidence
                ? `<strong>Confidence:</strong> ${face.confidence}<br>`
                : ""
              }
                                <strong>Status:</strong> <span class="live-indicator ${liveClass}"></span>${liveText}<br>
                                <strong>Location:</strong> Top: ${face.location.top
              }, Left: ${face.location.left}
                            </div>
                        `;

            container.appendChild(faceCard);
          });
        }

        document.getElementById("connectionStatus").textContent = "Connected";
        document.getElementById("connectionStatus").style.color = "#28a745";

        // Update JSON display
        document.getElementById("jsonData").textContent = JSON.stringify(
          data,
          null,
          2
        );
      } catch (error) {
        console.error("Error fetching detections:", error);
        document.getElementById("connectionStatus").textContent =
          "Disconnected";
        document.getElementById("connectionStatus").style.color = "#dc3545";
      }
    }

    async function updateSystemStatus() {
      try {
        const response = await fetch("/api/status");
        const data = await response.json();

        document.getElementById("cameraType").textContent = data.camera_type;
        document.getElementById("knownFaces").textContent =
          data.known_faces + " (" + data.faces_loaded.join(", ") + ")";
      } catch (error) {
        console.error("Error fetching system status:", error);
      }
    }

    async function updateHistory() {
      try {
        const response = await fetch("/api/history");
        const data = await response.json();

        const container = document.getElementById("historyContainer");

        if (data.total_entries === 0) {
          container.innerHTML = '<div class="no-faces">No history yet</div>';
        } else {
          container.innerHTML = "";

          // Show last 20 entries
          data.history.slice(0, 20).forEach((entry) => {
            const historyItem = document.createElement("div");
            historyItem.className = `history-item ${entry.state}`;

            const date = new Date(entry.timestamp * 1000);
            const timeString = date.toLocaleTimeString();

            historyItem.innerHTML = `
                            <div>
                                <div class="history-time">${timeString}</div>
                                <div class="history-name">${entry.name || "Unknown"
              }</div>
                            </div>
                            <div>
                                <span class="face-badge badge-${entry.state}">${entry.state
              }</span>
                            </div>
                        `;

            container.appendChild(historyItem);
          });
        }
      } catch (error) {
        console.error("Error fetching history:", error);
      }
    }

    // Clear history button
    document
      .getElementById("clearHistory")
      .addEventListener("click", async () => {
        try {
          await fetch("/api/history/clear", { method: "POST" });
          updateHistory();
        } catch (error) {
          console.error("Error clearing history:", error);
        }
      });

    // Update detections every second
    setInterval(updateDetections, 1000);

    // Update alerts every 1 second (frequent for security)
    setInterval(updateAlerts, 1000);

    // Update history every 2 seconds
    setInterval(updateHistory, 2000);

    // Check if face recognition needs to be restarted (e.g., after registration)
    async function ensureFaceRecognitionRunning() {
      try {
        const response = await fetch('/api/status');
        const data = await response.json();

        // If we get a response but known_faces is 0 or there's an error, try to restart
        if (response.status === 500 || !data.faces_loaded) {
          console.log('Face recognition may not be running, attempting to restart...');
          const exitResponse = await fetch('/api/control/exit_registration', { method: 'POST' });
          const exitData = await exitResponse.json();

          if (exitResponse.ok) {
            console.log('‚úÖ Face recognition restarted:', exitData.message);
            console.log('Faces loaded:', exitData.faces);
          } else {
            console.error('‚ùå Failed to restart face recognition:', exitData.message);
          }
        }
      } catch (error) {
        console.error('Error checking face recognition status:', error);
      }
    }

    // Update system status every 10 seconds
    setInterval(updateSystemStatus, 10000);

    // Initial load
    ensureFaceRecognitionRunning().then(() => {
      updateDetections();
      updateSystemStatus();
      updateHistory();
      updateAlerts();
    });
  </script>
</body>

</html>